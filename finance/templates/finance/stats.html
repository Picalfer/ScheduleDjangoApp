{% extends "core/base.html" %}
{% load humanize %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'finance/css/analytics.css' %}">
{% endblock %}

{% block content %}
    <div class="stats-container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <h1 class="stats-header">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —à–∫–æ–ª—ã</h1>
        <div class="stats-updated">–û–±–Ω–æ–≤–ª–µ–Ω–æ: {% now "j F Y H:i" %}</div>

        <!-- –§–∏–Ω–∞–Ω—Å—ã - —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–µ–∫—Ü–∏—è -->
        <div class="finance-centered">
            <div class="stat-card finance">
                <h2>üí∞ –§–∏–Ω–∞–Ω—Å—ã —à–∫–æ–ª—ã</h2>

                <div class="finance-main">
                    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –±–∞–ª–∞–Ω—Å -->
                    <div class="finance-balance">
                        <div class="balance-label">–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å —à–∫–æ–ª—ã</div>
                        <div class="balance-value">{{ finance_stats.current_balance|floatformat:0|intcomma }} ‚ÇΩ</div>
                        <div class="balance-subtitle">–î–æ—Ö–æ–¥—ã - —Ä–∞—Å—Ö–æ–¥—ã</div>
                    </div>

                    <!-- –°–≤–æ–±–æ–¥–Ω—ã–µ –¥–µ–Ω—å–≥–∏ -->
                    <div class="free-money-section">
                        <div class="free-money-label">üíé –°–≤–æ–±–æ–¥–Ω—ã–µ –¥–µ–Ω—å–≥–∏</div>
                        <div class="free-money-value">{{ finance_stats.free_money|floatformat:0|intcomma }} ‚ÇΩ</div>
                        <div class="free-money-subtitle">–ú–æ–∂–Ω–æ –≤–∫–ª–∞–¥—ã–≤–∞—Ç—å –≤ —Ä–∞–∑–≤–∏—Ç–∏–µ</div>
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∞ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –¥–µ—Ç–∞–ª–µ–π -->
                    <div class="toggle-details-section">
                        <button class="toggle-details-btn" onclick="toggleFinanceDetails()">
                            <span class="toggle-icon">‚ñº</span>
                            –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é
                        </button>
                    </div>

                    <!-- –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
                    <div id="financeDetails" class="finance-details hidden">
                        <div class="finance-row">
                            <span class="finance-label">–ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –≤—ã–ø–ª–∞—Ç:</span>
                            <span class="finance-amount warning">{{ finance_stats.reserved_money|floatformat:0|intcomma }} ‚ÇΩ</span>
                        </div>

                        <div class="add-expense-section">
                            <button class="add-expense-btn" onclick="openExpenseModal()">
                                ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥ —à–∫–æ–ª—ã
                            </button>
                            <br>
                            <br>
                            <a href="/finance/events/create/">–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–Ω–∞–ø—à–æ—Ç—ã</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="expenseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üí∏ –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥ —à–∫–æ–ª—ã</h3>
                <span class="close" onclick="closeExpenseModal()">&times;</span>
            </div>
            <form id="expenseForm">
                {% csrf_token %}
                <div class="form-group">
                    <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                    <select name="category" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                        <option value="advertising">–†–µ–∫–ª–∞–º–∞</option>
                        <option value="software">–°–æ—Ñ—Ç/–ü–æ–¥–ø–∏—Å–∫–∏</option>
                        <option value="taxes">–ù–∞–ª–æ–≥–∏</option>
                        <option value="other">–î—Ä—É–≥–æ–µ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>–°—É–º–º–∞ (‚ÇΩ):</label>
                    <input type="number" name="amount" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                    <input type="text" name="description" maxlength="200" required>
                </div>
                <div class="form-group">
                    <label>–î–∞—Ç–∞ —Ä–∞—Å—Ö–æ–¥–∞:</label>
                    <input type="date" name="expense_date" value="{{ today|date:'Y-m-d' }}" required>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeExpenseModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞—Å—Ö–æ–¥</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
    <div id="expenseNotification" class="notification hidden"></div>
{% endblock %}

{% block scripts %}
    <script src="{% static 'finance/js/analytics.js' %}"></script>
{% endblock %}