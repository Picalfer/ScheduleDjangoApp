{% extends 'core/base.html' %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'core/css/home.css' %}">
{% endblock %}

{% block content %}
    <div id="schedule-container">

        {% comment %}<img src="static/materials/materials-storage/test_image.jpg" alt="test_image">{% endcomment %}

        {% comment %}<img src="{% URL "materials/test_image.dd3733261fb3.jpg" %}" alt="test_image">{% endcomment %}

        {% csrf_token %}
        <div id="week-info">
            <div id="week-info-left">
                <div class="button-wrapper">
                    <button id="settings-button" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏" class="icon-button icon-rotate">
                        <span>‚öôÔ∏è</span>
                    </button>
                </div>
                {% if user.is_staff %}
                    <div class="button-wrapper">
                        <button id="teachers-button" title="–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏" class="icon-button icon-float">
                            <span>‚Äçüë®‚Äçüè´</span>
                        </button>
                    </div>

                    <div class="button-wrapper">
                        <button id="payments-button" title="–í—ã–ø–ª–∞—Ç—ã –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è–º"
                                class="icon-button icon-float">
                            <span>‚Äçüí∞</span>
                        </button>
                        <span id="payments-counter" class="notification-badge">0</span>
                    </div>

                    <div class="button-wrapper">
                        <button id="balance-alert-button" title="–¢—Ä–µ–±—É–µ—Ç –æ–ø–ª–∞—Ç—ã —É—Ä–æ–∫–æ–≤"
                                class="icon-button icon-float">
                            <span>üîî</span>
                        </button>
                        <span id="balance-alert-counter" class="notification-badge">0</span>
                    </div>
                    {% comment %}
                        <button id="add-student-button" title="–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É—á–µ–Ω–∏–∫–∞"
                                class="icon-button icon-button-float"
                                style="display: inline-block;"><span>‚ûï</span></button>{% endcomment %}
                {% endif %}
                <div id="open-windows-controls" style="display: none;">
                    <span>–û—Ç–º–µ—Ç—å—Ç–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ –æ–∫–Ω–∞</span>
                    <div style="display: inline-block">
                        <button id="save-open-windows">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button id="cancel-open-windows">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>
            </div>
            <div class="week-navigation">
                <div id="week-nav-left">
                    <button id="prev-week" class="nav-button">‚Üê</button>
                    <button id="current-week" class="nav-button">–°–µ–≥–æ–¥–Ω—è</button>
                </div>
                <h2>–ù–µ–¥–µ–ª—è: <span id="week-range"></span></h2>
                <button id="next-week" class="nav-button">‚Üí</button>
            </div>
        </div>
        <div id="headers">
            <div class="time-header">–í—Ä–µ–º—è</div>
            <div class="day-header">
                <div>–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫</div>
                <div class="date"></div>
            </div>
            <div class="day-header">
                <div>–í—Ç–æ—Ä–Ω–∏–∫</div>
                <div class="date"></div>
            </div>
            <div class="day-header">
                <div>–°—Ä–µ–¥–∞</div>
                <div class="date"></div>
            </div>
            <div class="day-header">
                <div>–ß–µ—Ç–≤–µ—Ä–≥</div>
                <div class="date"></div>
            </div>
            <div class="day-header">
                <div>–ü—è—Ç–Ω–∏—Ü–∞</div>
                <div class="date"></div>
            </div>
            <div class="day-header">
                <div>–°—É–±–±–æ—Ç–∞</div>
                <div class="date"></div>
            </div>
            <div class="day-header">
                <div>–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ</div>
                <div class="date"></div>
            </div>
        </div>
        <div id="schedule">
            <div class="time-column">
                <!-- –°–ª–æ—Ç—ã –≤—Ä–µ–º–µ–Ω–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            <div id="monday" class="week-day">
                <!-- –°–ª–æ—Ç—ã —á–∞—Å–æ–≤ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            <div id="tuesday" class="week-day">
                <!-- –°–ª–æ—Ç—ã —á–∞—Å–æ–≤ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            <div id="wednesday" class="week-day">
                <!-- –°–ª–æ—Ç—ã —á–∞—Å–æ–≤ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            <div id="thursday" class="week-day">
                <!-- –°–ª–æ—Ç—ã —á–∞—Å–æ–≤ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            <div id="friday" class="week-day">
                <!-- –°–ª–æ—Ç—ã —á–∞—Å–æ–≤ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            <div id="saturday" class="week-day">
                <!-- –°–ª–æ—Ç—ã —á–∞—Å–æ–≤ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            <div id="sunday" class="week-day">
                <!-- –°–ª–æ—Ç—ã —á–∞—Å–æ–≤ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>

    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="modal-header">
                <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è</h3>
            </div>
            <div class="modal-body">
                <form id="settings-form">
                    <div class="form-group">
                        <label for="start-hour">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —á–∞—Å—ã —Å</label>
                        <select id="start-hour">
                            <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="end-hour">–î–æ</label>
                        <select id="end-hour">
                            <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                        </select>
                    </div>
                    <div class="form-group theme-toggle">
                        <label for="theme-switch">–¢–µ–º–Ω–∞—è —Ç–µ–º–∞</label>
                        <label class="switch">
                            <input name="theme-switcher" type="checkbox" id="theme-switch">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="form-group" style="display: flex; align-items: center;">
                        <button id="set-open-windows" class="icon-button">üîÑ</button>
                        <span class="button-text" style="margin-left: 8px;">–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã–µ –æ–∫–Ω–∞</span>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="cancel-button">–û—Ç–º–µ–Ω–∏—Ç—å</button>
                <button class="submit-button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <div id="notification" style="display: none;"></div>

    <div id="selected-count">
        –û—Ç–∫—Ä—ã—Ç—ã—Ö –æ–∫–æ–Ω: <span id="count">0</span>
    </div>

    <div id="add-student-modal" class="modal" style="display: none;">
        <div class="modal-content" id="add-student-modal-content">
            <span class="close"
                  onclick="document.getElementById('add-student-modal').style.display='none'">&times;</span>
            <div class="modal-header">
                <h3>–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É—á–µ–Ω–∏–∫–∞</h3>
            </div>
            <div class="modal-body">
                <form id="add-student-form">
                    <div class="form-group">
                        <label for="client-id">–ö–ª–∏–µ–Ω—Ç</label>
                        <input type="text" id="client-id" placeholder="ID –∫–ª–∏–µ–Ω—Ç–∞" required
                               style="flex: 1; margin-right: 10px;">
                        <button id="find-client-button" type="button" class="submit-button"
                                style="margin-top: 10px;">–ù–∞–π—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞
                        </button>
                        <div id="client-info" style="display: none;"></div>
                    </div>
                    <div class="form-group">
                        <label for="teacher-id">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</label>
                        <input type="text" id="teacher-id" placeholder="ID –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è" required
                               style="flex: 1; margin-right: 10px;">
                        <button id="find-teacher-button" type="button" class="submit-button"
                                style="margin-top: 10px;">–ù–∞–π—Ç–∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è
                        </button>
                        <div id="teacher-info" style="display: none;"></div>
                    </div>
                    <div id="one-time-schedule-section" class="form-group">
                        <h3>–í–≤–æ–¥–Ω—ã–µ —É—Ä–æ–∫–∏</h3>
                        <button id="add-one-time-lesson-button" class="submit-button"
                                style="margin-top: 10px; margin-bottom: 10px;">
                            –î–æ–±–∞–≤–∏—Ç—å –≤–≤–æ–¥–Ω—ã–π —É—Ä–æ–∫
                        </button>
                        <div id="one-time-lessons-container"></div>
                    </div>

                    <div id="regular-schedule-section" class="form-group">
                        <h3>–ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h3>
                        <button id="add-regular-lesson-button" class="submit-button"
                                style="margin-top: 10px; margin-bottom: 10px; border: none">–î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π —É—Ä–æ–∫
                        </button>
                        <div id="regular-lessons-container"></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="cancel-button"
                        onclick="document.getElementById('add-student-modal').style.display='none'">–ó–∞–∫—Ä—ã—Ç—å
                </button>
                <button class="submit-button" id="submit-student">–î–æ–±–∞–≤–∏—Ç—å —É—á–µ–Ω–∏–∫–∞</button>
            </div>
        </div>
    </div>

    <div id="confirmation-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close"
                  onclick="document.getElementById('confirmation-modal').style.display='none'">&times;</span>
            <div class="modal-header">
                <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h3>
            </div>
            <div class="modal-body form-group" style="margin-top: 20px">
                <p id="confirmation-text" class="modal-text"></p>
                <div id="input-container" class="modal-input-container" style="display: none; margin-top: 20px">
                    <!-- –°—é–¥–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è input/textarea –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
            <div class="modal-actions">
                <button id="confirm-change" class="confirm-button">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                <button id="cancel-change" class="cancel-button">–û—Ç–º–µ–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <div id="schedule-info-panel" class="expanded">
        <button id="toggle-schedule-panel" class="toggle-button" title="–°–≤–µ—Ä–Ω—É—Ç—å">
            <svg id="toggle-icon" width="24" height="24" viewBox="0 0 24 24" fill="none"
                 xmlns="http://www.w3.org/2000/svg">
                <polyline points="8 5 15 12 8 19" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                          stroke-linejoin="round"></polyline>
            </svg>
        </button>
        <span id="schedule-info-text">–í—ã —Å–º–æ—Ç—Ä–∏—Ç–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ: <span id="schedule-info-text-name">–ê—Ä—Ç—É—Ä
                –ö–æ–∂–µ–º—è–∫–∏–Ω</span></span>
    </div>
{% endblock %}

{% block scripts %}
    <script>
        let currentUserId = {{ user_id }};
        let currentTeacherId = {{ teacher_id }}
        console.log(`UserId: ${currentUserId}`)
        console.log(`TeacherId: ${currentTeacherId}`)
        const userData = {
            isAdmin: {% if request.user.is_staff %}true{% else %}false{% endif %},
            username: "{{ request.user.username|escapejs }}"
        };
    </script>
    <script src="{% static 'core/schedule/home.js' %}" type="module"></script>
{% endblock %}