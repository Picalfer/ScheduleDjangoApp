{% extends '../core/base.html' %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'core/css/create_user.css' %}">
{% endblock %}

{% block content %}
    <div class="container">
        <h1 class="page-title">–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h1>

        {% if messages %}
            <div class="error-message general-error">
                {% for message in messages %}
                    <p>{{ message }}</p>
                {% endfor %}
            </div>
        {% endif %}

        <div class="form-container">
            <form method="post">
                {% csrf_token %}

                <div class="form-section">
                    <div class="form-group">
                        <label class="form-label">–õ–æ–≥–∏–Ω –≤ —Ñ–æ—Ä–º–∞—Ç–µ "IvanovMaksim"</label>
                        <input type="text" class="form-input {% if errors.username %}input-error{% endif %}"
                               name="username" required placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω"
                               value="{{ form_data.username|default:'' }}">
                        {% if errors.username %}
                            <span class="error-message">{{ errors.username }}</span>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label class="form-label">–ò–º—è</label>
                        <input type="text" class="form-input {% if errors.first_name %}input-error{% endif %}"
                               name="first_name" required placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è"
                               value="{{ form_data.first_name|default:'' }}">
                        {% if errors.first_name %}
                            <span class="error-message">{{ errors.first_name }}</span>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label class="form-label">–§–∞–º–∏–ª–∏—è</label>
                        <input type="text" class="form-input {% if errors.last_name %}input-error{% endif %}"
                               name="last_name" required placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é"
                               value="{{ form_data.last_name|default:'' }}">
                        {% if errors.last_name %}
                            <span class="error-message">{{ errors.last_name }}</span>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                        <div class="password-input-container">
                            <input type="text" class="form-input {% if errors.password %}input-error{% endif %}"
                                   name="password" id="password-input" required placeholder="–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –ø–∞—Ä–æ–ª—å"
                                   value="{{ form_data.password|default:'' }}">
                            <button type="button" class="generate-btn" id="generate-password">üé≤</button>
                        </div>
                        {% if errors.password %}
                            <span class="error-message">{{ errors.password }}</span>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label class="form-label">–†–æ–ª—å</label>
                        <select class="form-input {% if errors.role %}input-error{% endif %}" name="role" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å</option>
                            <option value="teacher" {% if form_data.role == 'teacher' %}selected{% endif %}>
                                –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å
                            </option>
                            <option value="manager" {% if form_data.role == 'manager' %}selected{% endif %}>–ú–µ–Ω–µ–¥–∂–µ—Ä
                            </option>
                            <option value="student" {% if form_data.role == 'student' %}selected{% endif %}>–°—Ç—É–¥–µ–Ω—Ç
                            </option>
                        </select>
                        {% if errors.role %}
                            <span class="error-message">{{ errors.role }}</span>
                        {% endif %}
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
                    <a href="{% url 'user_management' %}" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
                </div>
            </form>
        </div>
    </div>

    <script>
        function generatePassword() {
            const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let password = '';

            for (let i = 0; i < 8; i++) {
                password += chars[Math.floor(Math.random() * chars.length)];
            }

            return password;
        }

        document.getElementById('generate-password').addEventListener('click', function () {
            const passwordInput = document.getElementById('password-input');
            passwordInput.value = generatePassword();
        });

        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–∞—Ä–æ–ª—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
        document.addEventListener('DOMContentLoaded', function () {
            const passwordInput = document.getElementById('password-input');
            if (!passwordInput.value) {
                document.getElementById('generate-password').click();
            }
        });
    </script>
{% endblock %}